syntax = "proto3";

package librarian;

option go_package = "recon_com.lib.v1;lib";

import "google/protobuf/timestamp.proto";

// FileMetadata - метаданные файла
message FileMetadata {
  string id = 1;                    // Уникальный ID файла (генерируется клиентом или сервером)
  int64 size = 2;                   // Размер файла в байтах
  string hash_sha256 = 3;           // SHA256 хеш всего файла
  google.protobuf.Timestamp created_at = 4;  // Время создания TODO нужно ли?
  google.protobuf.Timestamp updated_at = 5; // Время обновления TODO нужно ли?
  FileSourceData file_source_data = 6;

  // Дополнительные метаданные
  map<string, string> metadata = 11;
}

// FileChunk - чанк (часть) файла
message FileChunk {
  bytes data = 1;                   // Данные чанка (бинарные данные)
  int32 chunk_number = 2;           // Номер чанка (начиная с 0)
  int32 total_chunks = 3;           // Общее количество чанков
  int64 chunk_size = 4;             // Размер этого чанка в байтах
  int64 total_size = 5;             // Общий размер файла в байтах

  // Валидация чанка
  string chunk_hash = 6;            // Хеш этого чанка (SHA256)
  int64 offset = 8;                 // Смещение чанка в файле
  bool is_last_chunk = 9;           // Является ли этот чанк последним

  // Временные метки
  google.protobuf.Timestamp sent_at = 10; // Когда чанк был отправлен

  // Информация о повторной отправке
  int32 retry_count = 11;           // Сколько раз чанк переотправлялся
  string chunk_id = 12;             // Уникальный ID чанка для дедупликации
}

// Данные для упаковки в БД источника
message FileSourceData{
  SourceType source_type = 2;
  Book book = 3;
  Article article = 4;
  Fragment fragment = 5;
  Photo photo = 6;
}

// Тип источника
enum SourceType {
  SOURCE_TYPE_UNKNOWN = 0;
  SOURCE_TYPE_BOOK = 1;
  SOURCE_TYPE_ARTICLE = 2;
  SOURCE_TYPE_FRAGMENT = 3;
  SOURCE_TYPE_PHOTO = 4;
}

enum FileFormat {
  // Неизвестный формат
  FILE_FORMAT_UNKNOWN = 0;

  // ========== ДОКУМЕНТЫ ==========

  // PDF документ
  FILE_FORMAT_PDF = 1;
  // Microsoft Word документы
  FILE_FORMAT_DOC = 2;   // Microsoft Word документ
  FILE_FORMAT_DOCX = 3;  // Microsoft Word Open XML

  // ========== СПЕЦИАЛЬНЫЕ ФОРМАТЫ ==========

  FILE_FORMAT_DJVU = 10;  // Сканированный документ DJVU
  FILE_FORMAT_CBR = 11;   // Комикс (RAR архив)
  FILE_FORMAT_CBZ = 12;   // Комикс (ZIP архив)
  FILE_FORMAT_DJV = 13;   // Сканированный документ DJVU (альтернативное расширение)

  // ========== ИЗОБРАЖЕНИЯ ==========

  FILE_FORMAT_PNG = 20;   // Изображение PNG
  FILE_FORMAT_JPG = 21;   // Изображение JPEG
  FILE_FORMAT_JPEG = 22;  // Изображение JPEG (альтернативное расширение)
  FILE_FORMAT_GIF = 23;   // Изображение GIF
  FILE_FORMAT_BMP = 24;   // Изображение BMP
  FILE_FORMAT_TIFF = 25;  // Изображение TIFF
  FILE_FORMAT_TIF = 26;   // Изображение TIFF (альтернативное расширение)
  FILE_FORMAT_SVG = 27;   // Векторное изображение SVG
}

message Book {
  int32 id = 1;
  string name_ru = 2;
  string name_native = 3;
  string author_ru = 4;
  int32 year = 5;
  repeated string  regions = 6;
  repeated string time_periods = 7;
  string description = 8;
  FileFormat file_format = 9;
}

message Article {
  int32 id = 1;
  string name_ru = 2;
  string name_native = 3;
  string author_ru = 4;
  int32 year = 5;
  repeated string  regions = 6;
  repeated string time_periods = 7;
  string description = 8;
  FileFormat file_format = 9;
}

message Fragment {
  int32 id = 1;
  string name_ru = 2;
  string name_native = 3;
  string author_ru = 4;
  int32 year = 5;
  repeated string  regions = 6;
  repeated string time_periods = 7;
  string description = 8;
  FileFormat file_format = 9;
}

message Photo {
  int32 id = 1;
  int32 group_id = 2;
  string name_ru = 3;
  string name_native = 4;
  string filming_location = 5;
  repeated string  regions = 6;
  repeated string time_periods = 7;
  string description = 8;
  FileFormat file_format = 9;
}